#!/usr/bin/env php
<?php

use App\VersionOne\AssetMetadata\PrimaryWorkitem\PrimaryWorkitemAssetMetadata;
use App\VersionOne\Command\ImportCommand;
use GO\Scheduler;

$rootDir = dirname(__DIR__);
$logsDir = $rootDir . '/var/log';
$console = $rootDir . '/bin/console';

require_once $rootDir . '/vendor/autoload.php';

$scheduler = new Scheduler;

$scheduler->raw(implode(' ', [$console, ImportCommand::NAME]), [], ImportCommand::NAME)
    ->everyMinute(15)
    ->onlyOne()
    ->output($logsDir . '/import-v1-assets.log', true);

$scheduler->raw(
        implode(' ', [$console, ImportCommand::NAME, (new PrimaryWorkitemAssetMetadata)->getType(), '-i']),
        [],
        // Use the same job ID to prevent importing of workitems when importing of all assets is already in progress
        ImportCommand::NAME
    )
    ->everyMinute(5)
    ->onlyOne()
    ->output($logsDir . '/import-v1-workitems.log', true);

$scheduler->run();

echo $scheduler->getVerboseOutput() . PHP_EOL;
